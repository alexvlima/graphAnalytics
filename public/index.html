<html>

<head>

	<title>Trabalho Final</title>

	<!--Import Google Icon Font-->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<!--Let browser know website is optimized for mobile-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css">


	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

	<!-- Compiled and minified JavaScript -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/js/materialize.min.js"></script>

	<script src="/socket.io/socket.io.js"></script>

</head>

<body>
	<style>
		header,
		main,
		footer {
			//padding-left: 300px;
			display: flex;
			flex-direction: column;
			height: 100%;
		}
		
		@media only screen and (max-width: 992px) {
			header,
			main,
			footer {
				padding-left: 0;
			}
		}
		
		.graph {
			width: 100%;
			height: 100%;
			background: #555;
		}
	</style>

	<header class="hide">
		<!-- MENU -->
		<ul id="slide-out" class="side-nav fixed">
			<li><a href="#!">First Sidebar Link</a></li>
			<li><a href="#!">Second Sidebar Link</a></li>
		</ul>
		<a href="#" data-activates="slide-out" class="button-collapse"><i class="material-icons">menu</i></a>

	</header>

	<main>

		<!-- NAVBAR -->
		<nav>
			<div class="nav-wrapper">
				<form>
					<div class="input-field">
						<input id="search" type="search" required>
						<label for="search"><i class="material-icons">search</i></label>
						<i class="material-icons">close</i>
					</div>
				</form>
			</div>
		</nav>

		<div class="graph" id='web'></div>

	</main>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.1.0/sigma.min.js"></script>

	<script>
		var s = new sigma('web')
		
		s.graph.addNode({
			// Main attributes:
			id: 0,
			label: 'Tweets',
			// Display attributes:
			x: 0,
			y: 0,
			size: 1,
			color: '#fff'
		})

		s.refresh()
	</script>

	<script>
		let socket = io.connect('https://localhost')
		
		let tweets = [{id: 0}]
		let preTweets = []

		//provisorio
		setInterval(() => {
			
			while(preTweets.length > 0){
				
				if(preTweets.length == 0) break 

				let t = preTweets.pop() 
				tweets.push(t)

				s.graph.addNode({
					// Main attributes:
					id: tweets.length,
					label: t.text,
					// Display attributes:
					x: 3,
					y: tweets.length,
					size: 1,
					color: '#fff'
				})

			}

			s.refresh()

		}, 3000)

		socket.on('newUser', (u) => {
			//console.log(u)
		})

		socket.on('newTweet', (t) => {
			//console.log(t)
			preTweets.push(t)
		})

		$('#search').keypress((event) => {
			if (event.which == 13) {
				event.preventDefault()
				
				socket.emit('startStream', { txt: $('#search').val() })
				
				$('#search').val(undefined)
				$('#search').blur()
			}
		})

	</script>

</body>

</html>